# 情节记忆相关的中文提示词

DEFAULT_CUSTOM_INSTRUCTIONS = """
生成情节记忆时请遵循以下原则：
1. 每个情节应该是一个完整、独立的故事或事件
2. 保留所有重要信息，包括姓名、时间、地点、情感等
3. 使用陈述性语言描述情节，而不是对话格式
4. 突出关键信息和情感变化
5. 确保情节内容便于后续检索
"""

GROUP_EPISODE_GENERATION_PROMPT = """
你是一位出色的事件记录与提炼专家，擅长将复杂的对话转化为清晰、连贯的“情景记忆”。
你的任务是提炼以下对话的核心内容，生成一段可读性强、信息量大的情景记忆。这份记忆应该像一个完整的故事，不仅记录了“发生了什么”，还清晰地展示了讨论的脉络和“结果如何”。

对话开始时间：{conversation_start_time}
对话内容：
{conversation}

自定义指令：
{custom_instructions}

请遵循以下指导原则：

1.  **叙事性与连贯性**：
    *   以第三人称视角，像讲故事一样，流畅地叙述整个事件的来龙去脉。
    *   从讨论的起点开始，描述关键的观点和转折点，最后总结出结论或当前状态。

2.  **关键信息提炼**：
    *   精准地识别出对话中的核心议题、关键决策、重要信息、各方观点和最终共识。
    *   将这些关键信息自然地融入到叙事中，而不是简单地罗列。

3.  **客观且忠于原文**：
    *   保持中立，客观地反映对话内容。
    *   可以进行总结和归纳，但不能添加原文未提及的主观评价或进行过度推断。
    *   **严格禁止任何形式的评价或引申**。例如，不能出现“这体现了...”、“这表明...”等带有总结、评价性质的语句。只需客观叙述事实。

4.  **为检索优化**：
    *   在叙述中保留关键的实体名词、项目名、技术术语、URL、文件路径等，方便未来检索。

请生成结构化情节记忆，仅返回包含以下两个字段的JSON对象：
{{
    "title": "（精炼、概括性的标题，包含核心事件与日期 YYYY-MM-DD）",
    "content": "（一段连贯的叙事性文本。关键的结论或待办事项应自然地融入文本中。）"
}}

示例（正确风格）：
{{
    "title": "V3版API性能优化方案讨论与决策 (2024-03-14)",
    "content": "团队围绕V3版API在高并发场景下的性能瓶颈展开了讨论。张伟首先指出了当前数据库查询缓慢是主要问题，并展示了相关的监控数据。随后，李静提出可以引入Redis作为缓存层来减轻数据库压力，这个观点得到了多数人的认同。经过讨论，团队最终达成一致：决定采用Redis作为一级缓存，并由李静负责对`user_profile`表的慢查询进行专项优化。张伟需要在本周五（2024-03-17）前完成缓存方案的初步设计，而李静则需要提交慢查询的分析报告。"
}}

自检清单（生成前必须逐项通过）：
- 返回的是否为严格的 JSON 格式？
- `title` 是否精炼地概括了事件核心并包含日期？
- `content` 是否是一段流畅连贯的叙事性文字，而非生硬的列表？
- 关键信息（如决策、待办）是否已自然地融入叙述中？

仅返回JSON对象，不要添加任何其他文本：
"""


EPISODE_GENERATION_PROMPT = """
你是一位专业的事件记录员，专注于从对话中为指定用户记录与其相关的关键事件。
你的任务是聚焦于 {user_name}，客观记录他/她所见、所闻、所言、所行，并将其转化为一段连贯、准确的事件记录。

用户名：{user_name}

对话开始时间：{conversation_start_time}
对话内容：
{conversation}

自定义指令：
{custom_instructions}

请遵循以下指导原则：

1.  **客观、中立的视角**：
    *   以事实为依据，核心是记录与 {user_name} 相关的事件，而不是将他/她塑造成故事主角。
    *   **严格区分角色**：如果 {user_name} 只是信息的接收者或提问者，记录必须清晰地反映这一点。例如，记录“{user_name} 了解到...”或“{user_name} 询问了关于...的情况”，而不是暗示他/她主导了讨论。
    *   过滤掉与 {user_name} 无直接关联的对话，但保留理解事件所必需的上下文。

2.  **连贯叙述**：
    *   将用户的关键行为和决策串联成一段流畅的叙述。例如，不要只写“{user_name} 同意了”，而是“在听取了大家的建议后，{user_name} 最终同意了该方案”，以体现上下文。
    *   清晰地展现 {user_name} 在事件中的角色和行为脉络。

3.  **提炼核心经历**：
    *   不仅是记录，更是提炼。总结出 {user_name} 在这次对话中的关键决策、重要计划、获得的承诺或遇到的问题。
    *   将这些核心信息自然地融入到叙述中。

4.  **忠于原文且易于理解**：
    *   所有内容必须基于对话原文，但可以用更具可读性的方式重新组织和表达。
    *   避免添加原文未提及的主观猜测或评价。

请生成结构化情节记忆，仅返回包含以下两个字段的JSON对象：
{{
    "title": "（关于`{user_name}`的[核心事件]的记录 YYYY-MM-DD）",
    "content": "（一段以`{user_name}`为中心的客观、连贯的叙事性文本。）"
}}

示例（错误风格，过于主观）：
{{
    "title": "{user_name} 领导了关于周末徒步的规划",
    "content": "{user_name} 发起了周末去雷尼尔山徒步的计划，并主导了关于装备的讨论。他/她最终拍板决定了出发时间，并安排了邀请朋友的事宜。"
}}

示例（正确风格，客观记录）：
{{
    "title": "{user_name} 参与规划周末雷尼尔山徒步 (2024-03-14)",
    "content": "{user_name} 在对话中提议本周末去雷尼尔山徒步，并询问了装备建议。在听取他人关于徒步靴、保暖衣物的建议后，{user_name} 决定于周六（2024-03-16）凌晨出发去看日出，并提到会邀请朋友同行。"
}}

自检清单：
- 返回的是否为严格的 JSON 格式？
- `title` 和 `content` 是否都严格围绕 `{user_name}` 展开？
- `content` 是否是一段流畅的经历叙述，而不是零散事实的堆砌？
- 所有关键信息是否都已自然地融入叙述中？

仅返回JSON对象，不要添加任何其他文本：
"""
